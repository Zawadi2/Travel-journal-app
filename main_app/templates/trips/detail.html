{% extends 'base.html' %}
{% load static %}
{% block head %}
<link rel="stylesheet" href="{% static 'css/trips/trip-detail.css' %}" />
{% endblock %}
{% block content %}
<section class="trip-container">
  <div class="trip-img">
    <img src="{% static 'images/sunglasses.jpeg' %}" alt="A suitcase with sunglasses" />
  </div>
  <div class="trip-detail">
    <h2>{{ trip.title }}</h2>
    <h1>{{ trip.destination }} ({{ trip.start_date }} - {{ trip.end_date }})</h1>
    <p>{{ trip.description }}</p>
  <!-- </div> -->
  <div class="trip-actions">
    <a href="{% url 'trip-update' trip.id %}" class="btn warn">Edit</a>
    <a href="{% url 'trip-delete' trip.id %}" class="btn danger">Delete</a>
  </div>
  </div>
  </div>
</section>
<!-- Existing trip-container above -->
<div class="journalEntry-tripevent-container">
  <section class="journalEntry">
    <div class="subsection-title">
      <h2>Journal Entry</h2>
      <img src="{% static 'images/bluebag.png' %}" alt="A blue suitcase" />
      <img src="{% static 'images/flyingplane.jpeg' %}" alt="A camera with a bag" />
      <img src="{% static 'images/lovepassport.jpeg' %}" alt="A traveling Passport" />
    </div>
    <h3>Add a JournalEntry</h3>
    <!-- Add just above the feedings table -->
    <form action="{% url 'add-journalEntry' trip.id %}" method="post" class="subsection-content" autocomplete="off">
      {% csrf_token %}
      {{ journalEntry_form.as_p }}
      <button type="submit" class="btn submit">Add JournalEntry</button>
    </form>
    <h3>Past JournalEntries</h3>
    {% if trip.journalentry_set.all.count > 0 %}
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        {% for journalEntry in trip.journalentry_set.all %}
        <tr>
          <td>{{ journalEntry.start_date }}</td>
          <td>{{ journalEntry.end_date }}</td>
          <td>{{ journalEntry.description }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <div class="subsection-content">
    <p>⚠️ {{trip.name}} not available!</p>
    </div>
    {% endif %}
    
  </section>
  <section class="JournalEntries">
    <!-- This is a long section -->
  </section>
  <section class="tripevents">
    <div class="subsection-title">
      <h2>Trip Events</h2>
      <img src="{% static 'images/lovepassport.jpeg' %}" alt="A taveling passport" />
      <img src="{% static 'images/girl.jpeg' %}" alt="A girl on trip" />
      <img src="{% static 'images/brownbag.png' %}" alt="A brown bag" />
    </div>

    <h3>{{ trip.name }} Tripevents</h3>
    <div class="subsection-content">
      {% if trip.tripevents.count %} 
        {% for tripevent in trip.tripevents.all %}
          <div class="tripevent-container">
            <div class="color-block" style="background-color: {{ tripevent.color }}"></div>
            <a href="{% url 'tripevent-detail' tripevent.id %}">
              <p>A {{ tripevent.color }} {{ tripevent.name }}</p>
            </a>
            <form action="{% url 'remove-tripevent' trip.id tripevent.id %}" method="post">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger">Remove Tripevent</button>
            </form>
          </div>
        {% endfor %} 
      {% else %}
        <p class="no-tripevents">{{trip.name}} doesn't have any tripevents!</p>
      {% endif %}
    </div>
  
    <h3>Available TripEvents</h3>
    <div class="subsection-content">
      {% if tripevents.count %} 
      {% for tripevent in tripevents %}
      <div class="tripevent-container">
        <div class="color-block" style="background-color: {{ tripevent.color }}"></div>
        <a href="{% url 'tripevent-detail' tripevent.id %}">
        <p>A{{ tripevent.color }} {{ tripevent.name }}</p>
        </a>
        <div class="dropdown">
          <button class="btn submit dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Make TripEvent
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        <form action="{% url 'associate-tripevent' trip.id tripevent.id %}" method="post" class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          {% csrf_token %}
          <!-- <button type="submit" class="btn submit">Make TripEvent</button> -->
          <button type="submit" name="event_type" value="s" class="dropdown-item">Sightseeing</button>
            <button type="submit" name="event_type" value="E" class="dropdown-item">Entertainment</button>
            <button type="submit" name="event_type" value="R" class="dropdown-item">Relaxation</button>
            <button type="submit" name="event_type" value="A" class="dropdown-item">Adventure</button>
        </form>
      </div>
      {% endfor %}
      {% else %}
      <p class="all-tripevents">{{trip.name}} already has all the available tripevents 🥳</p>
      {% endif %}
    </div>
  </section>
</div>
{% endblock %}