{% extends 'base.html' %}
{% load static %}
{% block head %}
<link rel="stylesheet" href="{% static 'css/trips/trip-detail.css' %}" />
{% endblock %}
{% block content %}
<section class="trip-container">
  <div class="trip-img">
    <img src="{% static 'images/sunglasses.jpeg' %}" alt="A suitcase with sunglasses" />
  </div>
  <div class="trip-detail">
    <h2>{{ trip.title }}</h2>
    <h1>{{ trip.destination }} ({{ trip.start_date }} - {{ trip.end_date }})</h1>
    <p>{{ trip.description }}</p>
  <!-- </div> -->
  <div class="trip-actions">
    <a href="{% url 'trip-update' trip.id %}" class="btn warn">Edit</a>
    <a href="{% url 'trip-delete' trip.id %}" class="btn danger">Delete</a>
  </div>
  </div>
  </div>
</section>
<!-- Existing trip-container above -->
<div class="journalEntry-tripevent-container">
  <section class="journalEntry">
    <div class="subsection-title">
      <h2>Journal Entry</h2>
      <img src="{% static 'images/bluebag.png' %}" alt="A blue suitcase" />
      <img src="{% static 'images/flyingplane.jpeg' %}" alt="A camera with a bag" />
      <img src="{% static 'images/lovepassport.jpeg' %}" alt="A traveling Passport" />
    </div>
    <h3>Add a JournalEntry</h3>
    <form action="{% url 'add-journalEntry' trip.id %}" method="post" class="subsection-content" autocomplete="off" enctype="multipart/form-data">
      {% csrf_token %}
      {{ journalEntry_form.as_p }}
      <button type="submit" class="btn submit">Add JournalEntry</button>
      {{journalEntry_form.errors}}
    </form>
    <h3>Past JournalEntries</h3>
    {% if trip.journalentry_set.all.count > 0 %}
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Photos</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        {% for journalEntry in trip.journalentry_set.all %}
        <tr>
          <td>{{ journalEntry.start_date }} 
      <td>
        {% if journalEntry.photos.all.count > 0 %}
          {% for photo in journalEntry.photos.all %}
          <img class="responsive-img card-panel" src="{{photo.url}}">
          {% empty %}
          {% endfor %}
          {% else %}
          <p>No photos available</p>
          {% endif %}
      </td>
      <td>{{ journalEntry.description }}</td>
      <td>{{journalEntry.get_journalEntries_display }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<div class="subsection-content">
  <p>:warning: {{trip.name}} not available!</p>
</div>
{% endif %}

</section>
  <section class="tripevents">
    <div class="subsection-title">
      <h2>Trip Events</h2>
      <img src="{% static 'images/lovepassport.jpeg' %}" alt="A taveling passport" />
      <img src="{% static 'images/girl.jpeg' %}" alt="A girl on trip" />
      <img src="{% static 'images/brownbag.png' %}" alt="A brown bag" />
    </div>

    <h3>{{ trip }} Tripevents</h3>
<div class="subsection-content">
    {% if trip.tripevents.count %} 
        {% for tripevent in trip.tripevents.all %}
            <div class="tripevent-container">
                <p>{{ tripevent.get_event_display }} on {{ tripevent.event_date }}</p>
                <form action="{% url 'remove-tripevent' trip.id tripevent.id %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Remove Trip Event</button>
                </form>
            </div>
        {% endfor %}
    {% else %}
        <p class="no-tripevents">{{ trip.title }} doesn't have any trip events!</p>
    {% endif %}
</div>


<h3>Available Trip Events</h3>
<div class="subsection-content">
    {% if tripevents.count %}
        {% for tripevent in tripevents %}
            <div class="tripevent-container">
              <form action="{% url 'associate-tripevent' trip.id %}" method="post">
                    {% csrf_token %}
                    <label for="event">Select Event Type:</label>
                    <div class="event-buttons">
                        {% for event in EVENTS %}
                            <button type="button" class="event-button" onclick="selectEvent('{{ event.0 }}')">{{ event.1 }}</button>
                        {% endfor %}
                    </div>
                    <input type="hidden" name="event" id="event-input" required>
                    
                    <label for="event_date">Event Date:</label>
                    <input type="date" name="event_date" id="event_date" required>
                    
                    <button type="submit" class="btn submit">Add Trip Event</button>
                </form>
            </div>
        {% endfor %}
    {% else %}
        <p class="all-tripevents">{{ trip.title }} already has all available trip events ðŸ¥³</p>
    {% endif %}
</div>    
{% endblock %}

